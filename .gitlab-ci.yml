stages:
  - scan

# 1. 백신 검사 (ClamAV)
virus_scan:
  stage: scan
  image: clamav/clamav:latest
  script:
    - freshclam || true 
    - clamscan -r . --log=clamav-result.txt
  allow_failure: true

# 2. 오픈소스 취약점 점검 (OSV)
osv_scan:
  stage: scan
  image:
    name: ghcr.io/google/osv-scanner:latest
    # entrypoint에 인자까지 모두 포함하여 고정시킵니다.
    entrypoint: ["/osv-scanner", "-r", "."]
  # GitLab이 -c 를 붙이지 못하도록 script 단계를 사실상 생략합니다.
  script:
    - "" 
  allow_failure: true